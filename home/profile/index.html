<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <style>
        /**
         * å­—ä½“å®šä¹‰
         * --------------------------------------
         */
        @font-face {
            font-family: 'JetBrains Mono';
            src: url('/static/fonts/JetBrainsMono-ExtraLight.woff2') format('woff2');
            font-weight: 200;
            font-style: normal;
            font-display: swap;
        }
        
        /**
         * å…¨å±€å˜é‡å’ŒåŸºç¡€æ ·å¼
         * --------------------------------------
         */
        :root {
            --font-sans: 'Microsoft YaHei', 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --color-bg: #000000;
            --color-text: #ffffff;
            --color-text-secondary: #cccccc;
            --color-text-tertiary: #aaaaaa;
            --color-border: #333333;
            --color-card-bg: #0c0c0c;
            --color-item-bg: #1a1a1a;
            --color-item-hover: #2a2a2a;
            --color-success: #4caf50;
            --color-warning: #ff9800;
            --color-error: #f44336;
            --radius-normal: 12px;
            --radius-large: 24px;
            --shadow-normal: 0 8px 12px rgba(0, 0, 0, 0.3);
            --anim-duration: 0.3s;
        }
        
        body {
            font-family: var(--font-sans);
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 0;
        }
        
        h1, h2, h3, h4, h5, h6, .card-title {
            font-family: var(--font-sans);
        }
        
        .item-title, .item-desc {
            font-family: var(--font-sans);
        }
        
        input, select, textarea, button {
            font-family: var(--font-sans);
        }
        
        /**
         * é¡µé¢åŠ è½½åŠ¨ç”»
         * --------------------------------------
         */        
        /* é¡µé¢å†…å®¹åŠ è½½æ•ˆæœ */
        .page-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        
        .page-content.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        /**
         * å¡ç‰‡ç»„ä»¶æ ·å¼
         * --------------------------------------
         */
        /* å¡ç‰‡åŸºç¡€æ ·å¼ */
        .card {
            background-color: var(--color-card-bg);
            border-radius: var(--radius-normal);
            padding: 25px;
            box-shadow: var(--shadow-normal);
            border: 1px solid var(--color-border);
            min-width: 250px;
            transition: transform var(--anim-duration) ease, 
                        box-shadow var(--anim-duration) ease, 
                        border-color var(--anim-duration) ease, 
                        opacity 0.5s ease;
            opacity: 0;
            transform: translateY(15px);
        }
        
        @media (min-width: 768px) {
            .card {
                border-radius: var(--radius-large);
                padding: 24px;
                gap: 14px;
                box-shadow: 0 51px 20px rgba(0, 0, 0, 0.01), 
                           0 29px 17px rgba(0, 0, 0, 0.05), 
                           0 13px 13px rgba(0, 0, 0, 0.09), 
                           0 3px 7px rgba(0, 0, 0, 0.1);
            }
        }
        
        .card.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 16px rgba(0, 0, 0, 0.4);
            border-color: #555555;
        }
        
        /* å¡ç‰‡ç±»å‹æ ·å¼ */
        .card-basic {
            grid-area: basic;
            min-height: 90px;
            align-self: start;
            padding: 24px;
            margin-bottom: 0;
        }
        
        .card-basic .card-title {
            font-size: 1.5rem;
            margin-bottom: 8px;
            margin-top: 10px;
        }
        
        .card-basic .info-item {
            margin-bottom: 10px;
        }
        
        .card-basic .info-label {
            font-size: 1rem;
            min-width: 100px;
        }
        
        .card-count {
            grid-area: count;
            align-self: start;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-bottom: 15px;
        }
        
        .card-count .inner-box {
            width: calc(100% - 32px);
        }
        
        .card-count .card-title {
            margin-bottom: 5px;
        }
        
        .card-count .info-item {
            margin-bottom: 5px;
        }
        
        .card-links {
            grid-area: links;
            margin-top: 0;
            padding-bottom: 15px;
            height: auto;
            display: flex;
            flex-direction: column;
        }
        
        .card-clients {
            grid-area: clients;
            margin-top: 0;
        }
        
        /* éåŸºæœ¬å¡ç‰‡çš„æ ‡é¢˜æ ·å¼ */
        .card:not(.card-basic) .card-title {
            margin-bottom: 15px;
            margin-top: 8px;
        }
        
        /**
         * å¯¼èˆªæ æ ·å¼
         * --------------------------------------
         */
        .navbar {
            background-color: var(--color-bg);
            border-radius: var(--radius-normal);
            margin: 15px 60px;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-normal);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            width: calc(100% - 120px);
            box-sizing: border-box;
            transition: box-shadow var(--anim-duration) ease, opacity 0.5s ease;
            opacity: 0;
        }
        
        .navbar.loaded {
            opacity: 1;
        }
        
        .navbar.scrolled {
            box-shadow: 0 0 20px 8px rgba(255, 255, 255, 0.1);
        }
        
        .navbar-brand {
            font-family: var(--font-sans);
            font-size: 24px;
            font-weight: bold;
            color: var(--color-text);
            text-decoration: none;
        }
        
        .navbar-nav {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .nav-item {
            margin: 0 15px;
        }
        
        .nav-link {
            font-family: var(--font-sans);
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: 16px;
            transition: color 0.2s ease;
        }
        
        .nav-link:hover {
            color: var(--color-text);
        }
        
        /**
         * ä¸ªäººèµ„æ–™å›¾æ ‡ä¸ä¸‹æ‹‰èœå•
         * --------------------------------------
         */
        .profile-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            background-color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .profile-icon svg {
            width: 24px;
            height: 24px;
            fill: var(--color-text);
        }
        
        .profile-dropdown {
            position: absolute;
            top: 55px;
            right: 0;
            background-color: #111111;
            border-radius: var(--radius-normal);
            border: 1px solid var(--color-border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            width: 250px;
            z-index: 1000;
            display: none;
        }
        
        .profile-dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            display: block;
            padding: 12px 16px;
            color: var(--color-text);
            text-decoration: none;
            border-bottom: 1px solid #222222;
            font-family: var(--font-sans);
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background-color: #222222;
        }
        
        .dropdown-divider {
            height: 1px;
            background-color: var(--color-border);
            margin: 0;
        }
        
        .dropdown-disabled {
            color: #666666;
            cursor: not-allowed;
        }
        
        .dropdown-disabled:hover {
            background-color: transparent;
        }
        
        .user-info-container {
            padding: 16px;
            border-bottom: 1px solid #222222;
        }
        
        #dropdown-user-name {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 5px 0;
            text-transform: uppercase;
        }
        
        #dropdown-user-email {
            font-size: 14px;
            color: var(--color-text-tertiary);
            margin: 0;
            word-break: break-all;
        }
        
        /**
         * ä¸»å†…å®¹åŒºåŸŸå¸ƒå±€
         * --------------------------------------
         */
        .profile-container {
            max-width: 1100px;
            margin: 120px auto 30px;
            padding: 0 40px;
        }
        
        h1.page-title {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .page-description {
            color: var(--color-text-secondary);
            margin-bottom: 40px;
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: 0.8fr 1.2fr;
            grid-template-rows: auto auto auto;
            grid-template-areas: 
                "basic count"
                "links count"
                "clients count";
            gap: 25px;
            margin-bottom: 35px;
        }
        
        /**
         * å¤´åƒç»„ä»¶æ ·å¼
         * --------------------------------------
         */
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .avatar-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin-right: 20px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
        }
        
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #333333;
            transition: filter var(--anim-duration) ease;
        }
        
        .avatar-upload {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.3);
            color: var(--color-text);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 32px;
            font-weight: 300;
            opacity: 0;
            transition: opacity var(--anim-duration) ease;
        }
        
        .avatar-container:hover .avatar {
            filter: grayscale(50%);
        }
        
        .avatar-container:hover .avatar-upload {
            opacity: 1;
        }
        
        .avatar-upload-input {
            display: none;
        }
        
        .user-name {
            font-size: 20px;
            font-weight: bold;
            margin: 0 0 5px 0;
            font-family: var(--font-sans);
        }
        
        .user-email {
            color: var(--color-text-tertiary);
            margin: 0;
            font-family: var(--font-sans);
        }
        
        /**
         * é€šçŸ¥æç¤ºç»„ä»¶
         * --------------------------------------
         */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: #333333;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: transform var(--anim-duration), opacity var(--anim-duration);
            transform: translateY(-20px);
            opacity: 0;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background-color: var(--color-success);
        }
        
        .toast.error {
            background-color: var(--color-error);
        }
        
        /**
         * ä¿¡æ¯é¡¹å’Œå¾½ç« æ ·å¼
         * --------------------------------------
         */
        .info-item {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .info-label {
            min-width: 150px;
            color: var(--color-text);
            text-align: left;
            font-weight: bold;
            font-family: var(--font-sans);
        }
        
        .info-value {
            flex: 1;
            color: var(--color-text);
            text-align: right;
            font-family: var(--font-sans);
        }
        
        .verified-badge {
            display: inline-block;
            background-color: var(--color-success);
            color: white;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            margin-right: 10px;
        }
        
        .not-verified-badge {
            display: inline-block;
            background-color: var(--color-warning);
            color: white;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            margin-right: 10px;
        }
        
        /**
         * è¿›åº¦æ¡ç›¸å…³æ ·å¼
         * --------------------------------------
         */
        .progress-bar {
            height: 8px;
            background-color: var(--color-item-bg);
            border-radius: 4px;
            margin-top: 10px;
            margin-bottom: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--color-success);
            border-radius: 4px;
            width: 0%;
            transition: width 1.5s cubic-bezier(0.22, 0.61, 0.36, 1);
            position: relative;
        }
        
        /* é—ªå…‰æ•ˆæœå®¹å™¨ */
        .shimmer-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.3s ease-in;
        }
        
        .shimmer-container.active {
            opacity: 1;
        }
        
        .shimmer-container.fadeout {
            opacity: 0;
            transition: opacity 1s ease-out;
        }
        
        /* é—ªå…‰åŠ¨ç”»å…ƒç´  */
        .shimmer-element {
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.2) 50%,
                transparent 100%
            );
            animation: shimmer-move 1.5s linear infinite;
        }
        
        @keyframes shimmer-move {
            0% {
                transform: translateX(-50%);
            }
            100% {
                transform: translateX(50%);
            }
        }
        
        .usage-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--color-text-tertiary);
            margin-top: 4px;
            line-height: 1.5;
        }
        
        .mono-text {
            font-family: var(--font-mono);
            font-weight: 200;
            letter-spacing: -0.02em;
            color: #bbb;
        }
        
        .mono-text strong {
            color: var(--color-text);
            font-weight: 400;
        }
        
        /**
         * æŒ‰é’®æ ·å¼
         * --------------------------------------
         */
        .btn {
            font-family: var(--font-sans);
            display: inline-block;
            background-color: #222222;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            border: none;
            margin-right: 10px;
            cursor: pointer;
            transition: background-color var(--anim-duration) ease;
        }
        
        .btn:hover {
            background-color: #333333;
        }
        
        .btn-primary {
            background-color: var(--color-text);
            color: var(--color-bg);
        }
        
        .btn-primary:hover {
            background-color: #dddddd;
        }
        
        /**
         * ä¼šè¯å’Œæ´»åŠ¨é¡¹ç»„ä»¶
         * --------------------------------------
         */
        .sessions-list {
            margin-top: 20px;
        }
        
        .session-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--color-item-bg);
            padding: 14px 16px;
            border-radius: var(--radius-normal);
            border: 1px solid rgba(51, 51, 51, 0.5);
            margin-bottom: 10px;
            transition: all var(--anim-duration) ease;
        }
        
        .session-item:hover {
            background-color: var(--color-item-hover);
            transform: translateX(5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .session-info {
            display: flex;
            align-items: center;
        }
        
        .device-icon {
            margin-right: 15px;
            font-size: 20px;
        }
        
        .session-details {
            color: var(--color-text-tertiary);
            font-size: 14px;
            margin-top: 3px;
        }
        
        .revoke-btn {
            background-color: #333333;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background-color var(--anim-duration) ease;
        }
        
        .revoke-btn:hover {
            background-color: #444444;
        }
        
        .loading-indicator {
            text-align: center;
            color: var(--color-text-tertiary);
            font-size: 14px;
        }
        
        /**
         * å¿«é€Ÿè¿æ¥å’Œäº’åŠ¨é¡¹ç›®
         * --------------------------------------
         */
        /* å¿«é€Ÿè¿æ¥ç‰¹å®šæ ·å¼ */
        .quick-links {
            margin-top: 15px;
            margin-bottom: 10px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* äº’åŠ¨é¡¹ç›®é€šç”¨æ ·å¼ï¼ˆå¿«é€Ÿè¿æ¥å’Œæœ€è¿‘ç™»å½•å®¢æˆ·ç«¯ï¼‰ */
        .interactive-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 14px;
            background-color: var(--color-item-bg);
            border-radius: var(--radius-normal);
            border: 1px solid rgba(51, 51, 51, 0.5);
            transition: all var(--anim-duration) ease;
            text-decoration: none;
            color: var(--color-text);
        }
        
        .interactive-item:hover {
            background-color: var(--color-item-hover);
            transform: translateX(5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .interactive-item:last-child {
            margin-bottom: 5px;
        }
        
        .item-icon {
            margin-right: 12px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--color-text);
        }
        
        .item-text {
            flex: 1;
        }
        
        .item-title {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .item-desc {
            font-size: 12px;
            color: var(--color-text-tertiary);
        }
        
        /**
         * å†…éƒ¨æ¡†æ¶æ ·å¼
         * --------------------------------------
         */
        .inner-box {
            background-color: var(--color-bg);
            border-radius: 8px;
            border: 1px solid var(--color-border);
            padding: 16px;
            margin-top: 2px;
        }
        
        .inner-box-title {
            font-family: var(--font-sans);
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 1rem;
            line-height: 1.4;
        }
        
        /**
         * å“åº”å¼è®¾è®¡
         * --------------------------------------
         */
        @media (min-width: 768px) {
            .session-item {
                border-radius: 16px;
                padding: 16px 18px;
            }
        }
        
        @media (max-width: 1024px) {
            .navbar {
                margin: 15px 40px;
                width: calc(100% - 80px);
            }
            
            .profile-container {
                padding: 0 30px;
            }
        }
        
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "basic"
                    "count"
                    "links"
                    "clients";
                gap: 20px;
            }
            
            .navbar {
                margin: 10px 20px;
                width: calc(100% - 40px);
            }
            
            .profile-container {
                margin: 100px auto 20px;
                padding: 0 20px;
            }
            
            h1.page-title {
                font-size: 36px;
            }
            
            .card-basic,
            .card-count {
                min-height: auto;
            }
            
            .quick-link-item,
            .interactive-item {
                padding: 12px;
            }
            
            .session-item {
                padding: 12px 14px;
            }
        }
        
        @media (max-width: 480px) {
            .navbar-nav {
                display: none;
            }
            
            .header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .avatar-container {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .interactive-item,
            .session-item {
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <a href="/" class="navbar-brand">LycreX</a>
        
        <ul class="navbar-nav">
            <li class="nav-item">
                <a href="https://lycrex.com" class="nav-link">LYCREX</a>
            </li>
            <li class="nav-item">
                <a href="https://git.lycrex.com" class="nav-link">GIT</a>
            </li>
            <li class="nav-item">
                <a href="https://lab.lycrex.com" class="nav-link">LAB</a>
            </li>
        </ul>
        
        <!-- ç”¨æˆ·ä¸ªäººèµ„æ–™å›¾æ ‡ä¸ä¸‹æ‹‰èœå• -->
        <div class="profile-icon" id="profileIcon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2a7.2 7.2 0 01-6-3.22c.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08a7.2 7.2 0 01-6 3.22z"/>
            </svg>
            
            <div class="profile-dropdown" id="profileDropdown">
                <div class="user-info-container">
                    <div class="user-name" id="dropdown-user-name">åŠ è½½ä¸­...</div>
                    <div class="user-email" id="dropdown-user-email">åŠ è½½ä¸­...</div>
                </div>
                <div class="dropdown-item dropdown-disabled">ä¸ªäººèµ„æ–™</div>
                <div class="dropdown-item dropdown-disabled">è´¦æˆ·è®¾ç½®</div>
                <div class="dropdown-divider"></div>
                <a href="/profile/logout" class="dropdown-item">é€€å‡ºç™»å½•</a>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="profile-container page-content">
        <h1 class="page-title">Settings</h1>
        <p class="page-description">You can manage your account, token, and client settings here.</p>

        <!-- ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
        <div class="header" style="margin-bottom: 40px;">
            <div class="avatar-container" id="avatar-upload-btn">
                <img id="user-avatar" alt="Avatar" class="avatar">
                <div class="avatar-upload">
                    <span>+</span>
                    <input type="file" id="avatar-input" class="avatar-upload-input" accept="image/png,image/jpeg,image/gif">
                </div>
            </div>
            <div>
                <h2 id="user-name" style="font-size: 32px; margin: 0; color: white;">Loading...</h2>
                <p id="user-email" style="color: #aaaaaa; margin: 5px 0 0 0;">Loading...</p>
            </div>
        </div>

        <!-- å†…å®¹å¡ç‰‡ç½‘æ ¼å¸ƒå±€ -->
        <div class="cards-grid">
            <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
            <div class="card card-basic">
                <h2 class="card-title">Basic Information</h2>
                <div class="info-item">
                    <div class="info-label">Name</div>
                    <div id="info-name" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Email</div>
                    <div class="info-value">
                        <span id="email-verified-badge" class="not-verified-badge">Loading...</span>
                        <span id="info-email">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- ç™»å½•ç»Ÿè®¡å¡ç‰‡ -->
            <div class="card card-count">
                <h2 class="card-title">Login Count</h2>
                
                <div class="inner-box">
                    <div class="inner-box-title">Last 30 Days Login Count</div>
                    <div class="progress-bar">
                        <div id="login-progress" class="progress-fill" style="width: 0%;"></div>
                    </div>
                    <div class="usage-details">
                        <span id="login-count-text" class="mono-text">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- å¿«é€Ÿé“¾æ¥å¡ç‰‡ -->
            <div class="card card-links">
                <h2 class="card-title">å¿«é€Ÿè¿æ¥</h2>
                <div class="quick-links">
                    <a href="https://lab.lycrex.com" class="interactive-item" target="_blank">
                        <div class="item-icon">ğŸ§ª</div>
                        <div class="item-text">
                            <div class="item-title">å®éªŒå®¤</div>
                            <div class="item-desc">Lab - æ¢ç´¢æœ€æ–°çš„æŠ€æœ¯ä¸é¡¹ç›®</div>
                        </div>
                    </a>
                    <a href="https://git.lycrex.com" class="interactive-item" target="_blank">
                        <div class="item-icon">ğŸ”„</div>
                        <div class="item-text">
                            <div class="item-title">Git ä»“åº“</div>
                            <div class="item-desc">Git - ä»£ç ç®¡ç†ä¸ç‰ˆæœ¬æ§åˆ¶</div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- æœ€è¿‘ç™»å½•å®¢æˆ·ç«¯å¡ç‰‡ -->
            <div class="card card-clients">
                <h2 class="card-title">æœ€è¿‘ç™»å½•çš„å®¢æˆ·ç«¯</h2>
                <div id="recent-clients-list" class="sessions-list">
                    <div class="loading-indicator">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
        <a href="/profile/logout" class="btn">Log Out</a>
    </div>

    <!-- æ¶ˆæ¯æç¤ºç»„ä»¶ -->
    <div id="toast" class="toast"></div>

    <script>
        /**
         * å…¨å±€å˜é‡å£°æ˜
         * --------------------------------------
         */
        // é˜²æ­¢é‡å®šå‘å¾ªç¯çš„æ ‡è®°
        let redirectAttempted = false;
        
        // DOMå¼•ç”¨ç¼“å­˜
        let dropdownUserName;
        let dropdownUserEmail;
        
        // å¡ç‰‡åŠ è½½çŠ¶æ€æ ‡è®°
        let cardsLoaded = false;
        
        /**
         * é¡µé¢åˆå§‹åŒ–
         * --------------------------------------
         */
        document.addEventListener('DOMContentLoaded', function() {
            // ä¼šè¯æ£€æŸ¥å’Œé‡å®šå‘å¤„ç†
            handleSessionCheck();
            
            // åˆå§‹åŒ–å„ä¸ªæ¨¡å—
            initData();
            initUI();
        });
        
        /**
         * åˆå§‹åŒ–æ•°æ®
         * --------------------------------------
         */
        function initData() {
            // åŠ è½½ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
            fetchUserInfo();
            
            // åŠ è½½ç™»å½•ç»Ÿè®¡ä¿¡æ¯
            fetchLoginStats();
        }
        
        /**
         * åˆå§‹åŒ–UIç»„ä»¶
         * --------------------------------------
         */
        function initUI() {
            // åˆå§‹åŒ–ä¸‹æ‹‰èœå•
            initProfileDropdown();
            
            // ç›‘å¬é¡µé¢æ»šåŠ¨ï¼Œä¸ºå¯¼èˆªæ æ·»åŠ å…‰æ™•æ•ˆæœ
            initNavbarScrollEffect();

            // åˆå§‹åŒ–å¤´åƒä¸Šä¼ åŠŸèƒ½
            initAvatarUpload();
            
            // åˆå§‹åŒ–é¡µé¢åŠ è½½åŠ¨ç”»
            initPageLoadAnimation();
        }
        
        /**
         * ä¼šè¯æ£€æŸ¥å’Œé‡å®šå‘å¤„ç†
         * --------------------------------------
         */
        function handleSessionCheck() {
            // æ£€æŸ¥URLä¸­æ˜¯å¦åŒ…å«é”™è¯¯å‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('error')) {
                const error = urlParams.get('error');
                
                // å¦‚æœå­˜åœ¨session_expiredé”™è¯¯ä¸”æ²¡æœ‰ä¹‹å‰çš„é‡å®šå‘å°è¯•
                if (error === 'session_expired' && !sessionStorage.getItem('redirectAttempted')) {
                    // è®¾ç½®æ ‡è®°ï¼Œé¿å…å†æ¬¡é‡å®šå‘
                    sessionStorage.setItem('redirectAttempted', 'true');
                    
                    // ç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µé¢
                    window.location.href = '/';
                    return;
                }
            } else {
                // å¦‚æœå½“å‰é¡µé¢æ²¡æœ‰é”™è¯¯å‚æ•°ï¼Œæ¸…é™¤ä¹‹å‰çš„é‡å®šå‘æ ‡è®°
                sessionStorage.removeItem('redirectAttempted');
            }
        }
        
        /**
         * åŠ¨ç”»ä¸è§†è§‰æ•ˆæœæ¨¡å—
         * --------------------------------------
         */
        
        /**
         * åˆå§‹åŒ–é¡µé¢åŠ è½½åŠ¨ç”»
         * æŒ‰é¡ºåºåŠ è½½å¯¼èˆªæ ã€é¡µé¢å†…å®¹å’Œå¡ç‰‡
         */
        function initPageLoadAnimation() {
            // æ˜¾ç¤ºå¯¼èˆªæ 
            setTimeout(() => {
                document.querySelector('.navbar').classList.add('loaded');
            }, 100);
            
            // æ˜¾ç¤ºé¡µé¢å†…å®¹
            setTimeout(() => {
                document.querySelector('.page-content').classList.add('loaded');
            }, 300);
            
            // é€ä¸ªæ˜¾ç¤ºå¡ç‰‡
            animateCards();
        }
        
        /**
         * å¡ç‰‡åŠ¨ç”»æ˜¾ç¤ºæ•ˆæœ
         */
        function animateCards() {
            const cards = document.querySelectorAll('.card');
            let lastCardIndex = cards.length - 1;
            
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('loaded');
                    
                    // å½“æœ€åä¸€å¼ å¡ç‰‡åŠ è½½å®Œæˆåï¼Œè®¾ç½®æ ‡è®°
                    if (index === lastCardIndex) {
                        cardsLoaded = true;
                        
                        // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œé€šçŸ¥å¡ç‰‡åŠ è½½å®Œæˆ
                        document.dispatchEvent(new CustomEvent('cardsLoaded'));
                    }
                }, 500 + (index * 150)); // æ¯ä¸ªå¡ç‰‡å»¶è¿Ÿ150msæ˜¾ç¤º
            });
        }
        
        /**
         * åˆå§‹åŒ–å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ
         */
        function initNavbarScrollEffect() {
            const navbar = document.querySelector('.navbar');
            window.addEventListener('scroll', function() {
                if (window.scrollY > 10) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            });
        }
        
        /**
         * åˆ›å»ºå¹¶å¯åŠ¨è¿›åº¦æ¡åŠ¨ç”»
         * @param {number} percentage - è¿›åº¦ç™¾åˆ†æ¯”(0-100)
         * @param {number} loginCount - ç™»å½•æ¬¡æ•°
         */
        function startProgressAnimation(percentage, loginCount) {
            const progressBar = document.getElementById('login-progress');
            
            // æ¸…ç†æ—§çš„é—ªå…‰å®¹å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
            const oldShimmer = document.querySelector('.shimmer-container');
            if (oldShimmer) {
                oldShimmer.parentNode.removeChild(oldShimmer);
            }
            
            // é‡ç½®è¿›åº¦æ¡å®½åº¦
            progressBar.style.width = '0%';
            
            // åˆ›å»ºæ–°çš„é—ªå…‰æ•ˆæœ
            const shimmerContainer = document.createElement('div');
            shimmerContainer.className = 'shimmer-container';
            
            const shimmerElement = document.createElement('div');
            shimmerElement.className = 'shimmer-element';
            
            shimmerContainer.appendChild(shimmerElement);
            progressBar.parentNode.appendChild(shimmerContainer);
            
            // è®¾ç½®è¿›åº¦æ¡å®½åº¦
            progressBar.style.width = `${percentage}%`;
            
            // æ ¹æ®ç™»å½•æ¬¡æ•°è®¾ç½®ä¸åŒçš„é¢œè‰²
            updateProgressColor(progressBar, loginCount);
            
            // æ˜¾ç¤ºé—ªå…‰æ•ˆæœ
            setTimeout(() => {
                shimmerContainer.classList.add('active');
                
                // ç­‰å¾…ä¸€æ®µæ—¶é—´åå¹³æ»‘æ·¡å‡ºé—ªå…‰æ•ˆæœ
                setTimeout(() => {
                    shimmerContainer.classList.add('fadeout');
                    
                    // æ·¡å‡ºå®Œæˆååˆ é™¤å…ƒç´ 
                    setTimeout(() => {
                        if (shimmerContainer.parentNode) {
                            shimmerContainer.parentNode.removeChild(shimmerContainer);
                        }
                    }, 1100); // ç­‰å¾…æ·¡å‡ºå®Œæˆåå†ç§»é™¤ï¼ˆç•¥å¤šäºæ·¡å‡ºæ—¶é—´ï¼‰
                }, 2500); // é—ªå…‰æ•ˆæœæ˜¾ç¤º2.5ç§’åå¼€å§‹æ·¡å‡º
            }, 100);
        }
        
        /**
         * æ ¹æ®ç™»å½•æ¬¡æ•°æ›´æ–°è¿›åº¦æ¡é¢œè‰²
         * @param {HTMLElement} progressBar - è¿›åº¦æ¡å…ƒç´ 
         * @param {number} loginCount - ç™»å½•æ¬¡æ•°
         */
        function updateProgressColor(progressBar, loginCount) {
            if (loginCount <= 30) {
                // 0-30æ¬¡ï¼šç»¿è‰²
                progressBar.style.backgroundColor = '#4caf50';
            } else if (loginCount <= 60) {
                // 31-60æ¬¡ï¼šé»„è‰²
                progressBar.style.backgroundColor = '#ffeb3b';
            } else if (loginCount <= 90) {
                // 61-90æ¬¡ï¼šæ©™è‰²
                progressBar.style.backgroundColor = '#ff9800';
            } else {
                // 91+æ¬¡ï¼šçº¢è‰²
                progressBar.style.backgroundColor = '#f44336';
            }
        }
        
        /**
         * äº¤äº’åŠŸèƒ½æ¨¡å—
         * --------------------------------------
         */
        
        /**
         * åˆå§‹åŒ–ä¸ªäººèµ„æ–™ä¸‹æ‹‰èœå•
         */
        function initProfileDropdown() {
            const profileIcon = document.getElementById('profileIcon');
            const profileDropdown = document.getElementById('profileDropdown');
            
            // åˆå§‹åŒ–å…¨å±€å˜é‡
            dropdownUserName = document.getElementById('dropdown-user-name');
            dropdownUserEmail = document.getElementById('dropdown-user-email');
            
            // ç‚¹å‡»å¤´åƒå›¾æ ‡æ˜¾ç¤º/éšè—ä¸‹æ‹‰èœå•
            profileIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                profileDropdown.classList.toggle('show');
            });
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹æ—¶å…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', function() {
                profileDropdown.classList.remove('show');
            });
        }
        
        /**
         * åˆå§‹åŒ–å¤´åƒä¸Šä¼ åŠŸèƒ½
         */
        function initAvatarUpload() {
            const avatarContainer = document.getElementById('avatar-upload-btn');
            const avatarInput = document.getElementById('avatar-input');
            
            // ç‚¹å‡»å¤´åƒå®¹å™¨è§¦å‘æ–‡ä»¶é€‰æ‹©
            avatarContainer.addEventListener('click', function() {
                avatarInput.click();
            });
            
            // å¤„ç†æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            avatarInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    
                    // éªŒè¯æ–‡ä»¶
                    if (!validateAvatarFile(file)) return;
                    
                    // é¢„è§ˆå›¾åƒ
                    previewAvatar(file);
                    
                    // ä¸Šä¼ å¤´åƒ
                    uploadAvatar(file);
                }
            });
            
            // é˜»æ­¢å†’æ³¡ï¼Œé¿å…ç‚¹å‡»inputæ—¶è§¦å‘containerçš„ç‚¹å‡»äº‹ä»¶
            avatarInput.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }
        
        /**
         * éªŒè¯å¤´åƒæ–‡ä»¶
         * @param {File} file - è¦éªŒè¯çš„æ–‡ä»¶å¯¹è±¡
         * @returns {boolean} éªŒè¯ç»“æœ
         */
        function validateAvatarFile(file) {
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º4MBï¼‰
            if (file.size > 4 * 1024 * 1024) {
                showToast('å¤´åƒæ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº4MBçš„å›¾ç‰‡', 'error');
                return false;
            }
            
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                showToast('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error');
                return false;
            }
            
            return true;
        }
        
        /**
         * é¢„è§ˆå¤´åƒå›¾ç‰‡
         * @param {File} file - è¦é¢„è§ˆçš„å›¾ç‰‡æ–‡ä»¶
         */
        function previewAvatar(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('user-avatar').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        /**
         * æ˜¾ç¤ºæ¶ˆæ¯æç¤º
         * @param {string} message - æç¤ºæ¶ˆæ¯å†…å®¹
         * @param {string} type - æç¤ºç±»å‹ï¼ˆsuccess/errorï¼‰
         */
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + type;
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }
        
        /**
         * æ•°æ®å¤„ç†æ¨¡å—
         * --------------------------------------
         */
        
        /**
         * è·å–ç”¨æˆ·ä¿¡æ¯
         */
        async function fetchUserInfo() {
            try {
                console.log('æ­£åœ¨è·å–ç”¨æˆ·ä¿¡æ¯...');
                const response = await fetch('/profile/api/userinfo');
                
                // å¤„ç†å“åº”é”™è¯¯
                if (!response.ok) {
                    handleResponseError(response.status);
                    return;
                }
                
                const userData = await response.json();
                console.log('ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ');
                
                // æ›´æ–°é¡µé¢ä¸Šçš„ç”¨æˆ·ä¿¡æ¯
                updateUserInterface(userData);
            } catch (error) {
                console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                
                // é˜²æ­¢æ— é™é‡å®šå‘å¾ªç¯
                if (!redirectAttempted) {
                    redirectAttempted = true;
                }
            }
        }
        
        /**
         * å¤„ç†APIå“åº”é”™è¯¯
         * @param {number} status - HTTPçŠ¶æ€ç 
         */
        function handleResponseError(status) {
            // å¦‚æœå“åº”ä¸æˆåŠŸï¼ˆå¦‚401æœªæˆæƒï¼‰ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
            if (status === 401) {
                console.warn('ç”¨æˆ·æœªæˆæƒï¼Œéœ€è¦é‡æ–°ç™»å½•');
                
                // é˜²æ­¢æ— é™é‡å®šå‘å¾ªç¯
                if (!redirectAttempted) {
                    redirectAttempted = true;
                    window.location.href = '/auth?error=session_expired';
                }
                return;
            }
            
            throw new Error(`APIè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${status}`);
        }

        /**
         * æ›´æ–°ç”¨æˆ·ç•Œé¢
         * @param {Object} user - ç”¨æˆ·æ•°æ®å¯¹è±¡
         */
        function updateUserInterface(user) {
            // æ›´æ–°å¤´åƒ
            updateUserAvatar(user);
            
            // è·å–ç”¨æˆ·å
            const username = user.preferred_username || user.name || user.username || '';
            
            // æ›´æ–°ç½‘é¡µæ ‡é¢˜ä¸ºç”¨æˆ·å
            document.title = username ? username : 'ä¸ªäººèµ„æ–™';
            
            // æ›´æ–°ç”¨æˆ·åæ˜¾ç¤º
            document.getElementById('user-name').textContent = username;
            document.getElementById('info-name').textContent = username;
            
            // æ›´æ–°ä¸‹æ‹‰èœå•ä¸­çš„ç”¨æˆ·ä¿¡æ¯
            if (!dropdownUserName) dropdownUserName = document.getElementById('dropdown-user-name');
            if (!dropdownUserEmail) dropdownUserEmail = document.getElementById('dropdown-user-email');
            
            if (dropdownUserName) dropdownUserName.textContent = username.toUpperCase();
            if (dropdownUserEmail) dropdownUserEmail.textContent = user.email || '';
            
            // æ›´æ–°é‚®ç®±
            document.getElementById('user-email').textContent = user.email || '';
            document.getElementById('info-email').textContent = user.email || '';
            
            // æ›´æ–°é‚®ç®±éªŒè¯çŠ¶æ€
            updateEmailVerificationStatus(user.email_verified);
            
            // æ›´æ–°æœ€è¿‘30å¤©ç™»å½•æ¬¡æ•°
            updateLoginCountInfo(user.recent_login_count || 0);
        }
        
        /**
         * æ›´æ–°ç”¨æˆ·å¤´åƒ
         * @param {Object} user - ç”¨æˆ·æ•°æ®å¯¹è±¡
         */
        function updateUserAvatar(user) {
            const avatarElement = document.getElementById('user-avatar');
            const timestamp = new Date().getTime();
            
            // è®¾ç½®ç”¨æˆ·å¤´åƒ
            if (user.avatar_url) {
                // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ä»¥é¿å…ç¼“å­˜
                const avatarUrl = addTimestampToUrl(user.avatar_url, timestamp);
                avatarElement.src = avatarUrl;
            }
            // å¤‡é€‰æ–¹æ¡ˆï¼Œå¦‚æœavatar_urlä¸å­˜åœ¨ä½†æœ‰å…¶ä»–å¤´åƒå­—æ®µ
            else if (user.avatar || user.picture) {
                const avatarData = user.avatar || user.picture;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„URLæˆ–data URI
                if (avatarData.startsWith('http://') || avatarData.startsWith('https://')) {
                    // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ä»¥é¿å…ç¼“å­˜
                    const avatarUrl = addTimestampToUrl(avatarData, timestamp);
                    avatarElement.src = avatarUrl;
                } else if (avatarData.startsWith('data:')) {
                    // data URIä¸éœ€è¦æ·»åŠ æ—¶é—´æˆ³
                    avatarElement.src = avatarData;
                }
            }
        }
        
        /**
         * å‘URLæ·»åŠ æ—¶é—´æˆ³å‚æ•°
         * @param {string} url - åŸå§‹URL
         * @param {number} timestamp - æ—¶é—´æˆ³
         * @returns {string} æ·»åŠ æ—¶é—´æˆ³åçš„URL
         */
        function addTimestampToUrl(url, timestamp) {
            return url.includes('?') 
                ? `${url}&t=${timestamp}` 
                : `${url}?t=${timestamp}`;
        }
        
        /**
         * æ›´æ–°é‚®ç®±éªŒè¯çŠ¶æ€
         * @param {boolean} isVerified - æ˜¯å¦å·²éªŒè¯
         */
        function updateEmailVerificationStatus(isVerified) {
            const emailVerifiedBadge = document.getElementById('email-verified-badge');
            if (isVerified) {
                emailVerifiedBadge.textContent = 'Verified';
                emailVerifiedBadge.className = 'verified-badge';
            } else {
                emailVerifiedBadge.textContent = 'Not Verified';
                emailVerifiedBadge.className = 'not-verified-badge';
            }
        }
        
        /**
         * æ›´æ–°ç™»å½•æ¬¡æ•°ä¿¡æ¯
         * @param {number} loginCount - ç™»å½•æ¬¡æ•°
         */
        function updateLoginCountInfo(loginCount) {
            // æ›´æ–°ç™»å½•æ¬¡æ•°æ–‡æœ¬
            document.getElementById('login-count-text').innerHTML = 
                `You have logged in <strong>${loginCount}</strong> times in the last 30 days`;
            
            // è®¡ç®—è¿›åº¦æ¡ç™¾åˆ†æ¯”ï¼ˆæœ€å¤§å€¼ä¸º100ï¼‰
            const maxLogins = 100;
            const percentage = Math.min(100, (loginCount / maxLogins) * 100);
            
            // æ£€æŸ¥å¡ç‰‡æ˜¯å¦å·²åŠ è½½å®Œæˆ
            if (cardsLoaded) {
                // å¦‚æœå¡ç‰‡å·²åŠ è½½å®Œæˆï¼Œå»¶è¿Ÿä¸€å°æ®µæ—¶é—´åå¯åŠ¨è¿›åº¦æ¡åŠ¨ç”»
                setTimeout(() => startProgressAnimation(percentage, loginCount), 300);
            } else {
                // å¦‚æœå¡ç‰‡å°šæœªåŠ è½½å®Œæˆï¼Œç›‘å¬å¡ç‰‡åŠ è½½å®Œæˆäº‹ä»¶
                document.addEventListener('cardsLoaded', function onCardsLoaded() {
                    // å¡ç‰‡åŠ è½½å®Œæˆåç­‰å¾…ä¸€å°æ®µæ—¶é—´å†å¼€å§‹åŠ¨ç”»
                    setTimeout(() => startProgressAnimation(percentage, loginCount), 300);
                    
                    // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤æ‰§è¡Œ
                    document.removeEventListener('cardsLoaded', onCardsLoaded);
                });
            }
        }

        /**
         * è·å–ç™»å½•ç»Ÿè®¡ä¿¡æ¯
         */
        async function fetchLoginStats() {
            try {
                console.log('æ­£åœ¨è·å–ç™»å½•ç»Ÿè®¡...');
                const response = await fetch('/profile/api/user/login-stats');
                
                if (!response.ok) {
                    // å¤„ç†é”™è¯¯ä½†ä¸é‡å®šå‘
                    if (response.status === 401) {
                        console.warn('è·å–ç™»å½•ç»Ÿè®¡æ—¶ç”¨æˆ·æœªæˆæƒ');
                        return;
                    }
                    throw new Error('è·å–ç™»å½•ç»Ÿè®¡å¤±è´¥');
                }
                
                const statsData = await response.json();
                console.log('ç™»å½•ç»Ÿè®¡è·å–æˆåŠŸ');
                
                // ä»ç™»å½•ç»Ÿè®¡ä¸­æå–å®¢æˆ·ç«¯ä¿¡æ¯å¹¶æ›´æ–°UI
                if (statsData && statsData.client_stats) {
                    displayRecentClients(statsData.client_stats, statsData);
                } else {
                    displayRecentClientsError('æ— æ³•è·å–å®¢æˆ·ç«¯ç»Ÿè®¡ä¿¡æ¯');
                }
            } catch (error) {
                console.error('è·å–ç™»å½•ç»Ÿè®¡å¤±è´¥:', error);
                displayRecentClientsError('æ— æ³•åŠ è½½ç™»å½•ç»Ÿè®¡ä¿¡æ¯');
            }
        }
        
        /**
         * æ˜¾ç¤ºæœ€è¿‘ç™»å½•çš„å®¢æˆ·ç«¯
         * @param {Array} clientStats - å®¢æˆ·ç«¯ç»Ÿè®¡æ•°æ®
         * @param {Object} statsData - ç»Ÿè®¡æ€»æ•°æ®
         */
        function displayRecentClients(clientStats, statsData) {
            const container = document.getElementById('recent-clients-list');
            
            // æ¸…ç©ºåŠ è½½æŒ‡ç¤ºå™¨
            container.innerHTML = '';
            
            if (!clientStats || clientStats.length === 0) {
                container.innerHTML = '<div class="loading-indicator">æ²¡æœ‰æ‰¾åˆ°æœ€è¿‘çš„ç™»å½•è®°å½•</div>';
                return;
            }
            
            // æ·»åŠ æ—¶é—´èŒƒå›´ä¿¡æ¯
            addDateRangeInfo(container, statsData);
            
            // å¯¹å®¢æˆ·ç«¯æŒ‰ç…§æœ€åç™»å½•æ—¶é—´æ’åºï¼ˆæœ€è¿‘çš„åœ¨å‰ï¼‰
            const sortedClients = sortClientsByLastLogin(clientStats);
            
            // ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªé¡¹ç›®
            createClientElements(container, sortedClients);
        }
        
        /**
         * æ·»åŠ æ—¥æœŸèŒƒå›´ä¿¡æ¯
         * @param {HTMLElement} container - å®¹å™¨å…ƒç´ 
         * @param {Object} statsData - ç»Ÿè®¡æ•°æ®
         */
        function addDateRangeInfo(container, statsData) {
            let dayRange = 30; // é»˜è®¤30å¤©
            
            if (statsData && statsData.start_date && statsData.end_date) {
                const startDate = new Date(statsData.start_date);
                const endDate = new Date(statsData.end_date);
                dayRange = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24));
                
                const rangeElement = document.createElement('div');
                rangeElement.className = 'date-range-info';
                rangeElement.style.marginBottom = '15px';
                rangeElement.style.color = '#aaaaaa';
                rangeElement.textContent = `æœ€è¿‘${dayRange}å¤©`;
                container.appendChild(rangeElement);
            }
        }
        
        /**
         * æŒ‰æœ€åç™»å½•æ—¶é—´æ’åºå®¢æˆ·ç«¯
         * @param {Array} clientStats - å®¢æˆ·ç«¯ç»Ÿè®¡æ•°æ®
         * @returns {Array} æ’åºåçš„å®¢æˆ·ç«¯æ•°ç»„
         */
        function sortClientsByLastLogin(clientStats) {
            return [...clientStats].sort((a, b) => {
                const lastLoginA = new Date(a.last_login);
                const lastLoginB = new Date(b.last_login);
                return lastLoginB - lastLoginA; // é™åºæ’åˆ—ï¼Œæœ€è¿‘çš„åœ¨å‰
            });
        }
        
        /**
         * åˆ›å»ºå®¢æˆ·ç«¯å…ƒç´ 
         * @param {HTMLElement} container - å®¹å™¨å…ƒç´ 
         * @param {Array} clients - å®¢æˆ·ç«¯æ•°ç»„
         */
        function createClientElements(container, clients) {
            clients.forEach((client, index) => {
                // æ ¼å¼åŒ–æœ€åç™»å½•æ—¶é—´
                const lastLogin = new Date(client.last_login);
                const timeAgo = getTimeAgo(lastLogin);
                
                // ç¡®å®šå®¢æˆ·ç«¯å›¾æ ‡
                const clientIcon = getClientIcon(client.client_name);
                
                // åˆ›å»ºå®¢æˆ·ç«¯å…ƒç´ 
                const clientElement = document.createElement('div');
                clientElement.className = 'interactive-item';
                clientElement.style.opacity = '0';
                clientElement.style.transform = 'translateY(10px)';
                clientElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                clientElement.innerHTML = `
                    <div class="item-icon">${clientIcon}</div>
                    <div class="item-text">
                        <div class="item-title">${client.client_name}</div>
                        <div class="item-desc">
                            <span style="color: #ccc; font-weight: 500;">${timeAgo}</span> Â· å…±ç™»å½• ${client.login_count} æ¬¡
                        </div>
                    </div>
                `;
                
                container.appendChild(clientElement);
                
                // é”™å¼€æ˜¾ç¤ºæ¯ä¸ªå®¢æˆ·ç«¯é¡¹
                setTimeout(() => {
                    clientElement.style.opacity = '1';
                    clientElement.style.transform = 'translateY(0)';
                }, 100 + (index * 80));
            });
        }
        
        /**
         * è·å–å®¢æˆ·ç«¯å›¾æ ‡
         * @param {string} clientName - å®¢æˆ·ç«¯åç§°
         * @returns {string} å›¾æ ‡
         */
        function getClientIcon(clientName) {
            const name = clientName.toLowerCase();
            
            if (name.includes('web') || name.includes('ç½‘é¡µ')) return 'ğŸŒ';
            if (name.includes('desktop') || name.includes('æ¡Œé¢')) return 'ğŸ’»';
            if (name.includes('mobile') || name.includes('æ‰‹æœº')) return 'ğŸ“±';
            
            return 'ğŸ”¹'; // é»˜è®¤å›¾æ ‡
        }
        
        /**
         * æ˜¾ç¤ºæœ€è¿‘ç™»å½•å®¢æˆ·ç«¯çš„é”™è¯¯
         * @param {string} message - é”™è¯¯ä¿¡æ¯
         */
        function displayRecentClientsError(message) {
            console.warn('æ˜¾ç¤ºå®¢æˆ·ç«¯é”™è¯¯:', message);
            const container = document.getElementById('recent-clients-list');
            container.innerHTML = `<div class="loading-indicator" style="color: #ff8888;">${message}</div>`;
        }
        
        /**
         * è®¡ç®—æ—¶é—´å·®ï¼ˆå‡ å¤©å‰ã€å‡ å°æ—¶å‰ç­‰ï¼‰
         * @param {Date} date - è¦è®¡ç®—çš„æ—¥æœŸ
         * @returns {string} æ ¼å¼åŒ–åçš„æ—¶é—´å·®
         */
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHours = Math.floor(diffMin / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffDays > 0) {
                if (diffDays === 1) {
                    return 'æ˜¨å¤©';
                } else if (diffDays < 7) {
                    return `${diffDays} å¤©å‰`;
                } else if (diffDays < 31) {
                    const weeks = Math.floor(diffDays / 7);
                    return weeks === 1 ? '1 å‘¨å‰' : `${weeks} å‘¨å‰`;
                } else {
                    const months = Math.floor(diffDays / 30);
                    return months === 1 ? '1 ä¸ªæœˆå‰' : `${months} ä¸ªæœˆå‰`;
                }
            } else if (diffHours > 0) {
                return diffHours === 1 ? '1 å°æ—¶å‰' : `${diffHours} å°æ—¶å‰`;
            } else if (diffMin > 0) {
                return diffMin === 1 ? '1 åˆ†é’Ÿå‰' : `${diffMin} åˆ†é’Ÿå‰`;
            } else if (diffSec > 30) {
                return `${diffSec} ç§’å‰`;
            } else {
                return 'åˆšåˆš';
            }
        }

        /**
         * ä¸Šä¼ å¤´åƒ
         * @param {File} file - è¦ä¸Šä¼ çš„æ–‡ä»¶
         */
        async function uploadAvatar(file) {
            try {
                console.log('æ­£åœ¨ä¸Šä¼ å¤´åƒ...');
                
                // åˆ›å»ºFormDataå¯¹è±¡
                const formData = new FormData();
                formData.append('avatar', file);
                
                // å‘é€è¯·æ±‚
                const uploadResponse = await fetch('/profile/api/upload-avatar', {
                    method: 'POST',
                    body: formData
                });
                
                if (!uploadResponse.ok) {
                    const errorData = await uploadResponse.json();
                    throw new Error(errorData.error || 'ä¸Šä¼ å¤´åƒå¤±è´¥');
                }
                
                console.log('å¤´åƒä¸Šä¼ æˆåŠŸ');
                
                // ä¸Šä¼ æˆåŠŸ
                showToast('å¤´åƒä¸Šä¼ æˆåŠŸ', 'success');
                
                // æ·»åŠ æ—¶é—´æˆ³å‚æ•°ä»¥å¼ºåˆ¶æ›´æ–°ç¼“å­˜çš„å¤´åƒ
                refreshAvatarCache();
                
                // é‡æ–°åŠ è½½ç”¨æˆ·ä¿¡æ¯ä»¥æ›´æ–°å¤´åƒ
                setTimeout(() => {
                    fetchUserInfo();
                }, 1000);
                
            } catch (error) {
                console.error('ä¸Šä¼ å¤´åƒå¤±è´¥:', error);
                showToast(error.message || 'ä¸Šä¼ å¤´åƒå¤±è´¥', 'error');
            }
        }
        
        /**
         * åˆ·æ–°å¤´åƒç¼“å­˜
         */
        function refreshAvatarCache() {
            const timestamp = new Date().getTime();
            const userAvatar = document.getElementById('user-avatar');
            
            // å¦‚æœå½“å‰å¤´åƒæ˜¯URLï¼ˆédata:å¼€å¤´çš„URIï¼‰ï¼Œæ·»åŠ æ—¶é—´æˆ³å‚æ•°
            if (userAvatar.src && !userAvatar.src.startsWith('data:')) {
                // å¤„ç†URLï¼Œæ·»åŠ æˆ–æ›´æ–°æ—¶é—´æˆ³å‚æ•°
                let avatarUrl = new URL(userAvatar.src);
                avatarUrl.searchParams.set('t', timestamp);
                userAvatar.src = avatarUrl.toString();
            }
        }
    </script>
</body>
</html> 